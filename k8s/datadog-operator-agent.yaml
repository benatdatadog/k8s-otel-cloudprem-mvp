---
# DatadogAgent CRD - Deploys DD Agent via Datadog Operator
# In OP branch: Agent handles infrastructure metrics only
# OTLP logs flow: App → OTEL Collector → OP Worker → CloudPrem
apiVersion: datadoghq.com/v2alpha1
kind: DatadogAgent
metadata:
  name: datadog
  namespace: otel-demo
spec:
  global:
    clusterName: otel-demo
    site: datadoghq.com
    credentials:
      apiSecret:
        secretName: datadog-secrets
        keyName: api-key
    # Kubelet config for Docker Desktop
    kubelet:
      tlsVerify: false

  features:
    # Container log collection DISABLED for OP branch
    # All logs flow through: App → OTEL Collector → OP Worker → CloudPrem
    logCollection:
      enabled: false
      containerCollectAll: false

    # Prometheus scraping for infrastructure metrics
    prometheusScrape:
      enabled: true
      enableServiceEndpoints: true

    # APM disabled - traces go direct from OTEL Collector to DD SaaS
    apm:
      enabled: false

